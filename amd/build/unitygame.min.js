define("mod_webgl/unitygame",["exports","core/ajax","core/modal_events","core/modal_save_cancel","core/str","core/templates","jquery"],(function(_exports,_ajax,_modal_events,_modal_save_cancel,_str,_templates,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_events=_interopRequireDefault(_modal_events),_modal_save_cancel=_interopRequireDefault(_modal_save_cancel),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery),window.mod_webgl_plugin={initted:!1,trackGameViewed:()=>{},trackGameProgress:()=>{}};_exports.init=()=>{const handleCompletionData=async completiondata=>{const activityInfosBlock=(0,_jquery.default)(".activity-information");if(activityInfosBlock.length){const renderObject=await _templates.default.renderForPromise("core_course/activity_info",completiondata);await _templates.default.replaceNode(activityInfosBlock[0],renderObject.html,renderObject.js)}if(completiondata.overallcomplete){window.console.error("should show complete dialog");const modalbacktocourse=await _modal_save_cancel.default.create({title:(0,_str.get_string)("gamecompletedialog","mod_webgl"),body:(0,_str.get_string)("gamecompletedialogbody","mod_webgl"),buttons:{cancel:(0,_str.get_string)("gamecompletedialogcancel","mod_webgl"),save:(0,_str.get_string)("gamecompletedialogsave","mod_webgl")}});modalbacktocourse.getRoot().off("click"),modalbacktocourse.getRoot().on(_modal_events.default.save,(()=>{(0,_jquery.default)("#mod_webgl_course_url").submit()})),modalbacktocourse.show()}},setGameLoaded=async()=>{const webglid=(0,_jquery.default)(".webgl-iframe-content-loader").data("webgl"),response=await(0,_ajax.call)([{methodname:"mod_webgl_signal_game_loaded",args:{webglid:webglid}}])[0];response?(handleCompletionData(response.completiondata),window.console.log(response)):window.console.error("Error setting webgl "+webglid+" as viewed")},checkWebglIframeLoaded=()=>{const unityFrame=(0,_jquery.default)(".webgl-iframe-content-loader iframe");if(unityFrame.length<1)return;const unityLoadingBar=unityFrame[0].contentDocument.querySelector("#unity-loading-bar");if(!unityLoadingBar)return;"none"==unityLoadingBar.style.display?setGameLoaded():setTimeout(checkWebglIframeLoaded,250)};window.mod_webgl_plugin.trackGameViewed=setGameLoaded,window.mod_webgl_plugin.trackGameProgress=async progressData=>{const webglid=(0,_jquery.default)(".webgl-iframe-content-loader").data("webgl");window.console.log("Setting progress data object"),window.console.log(progressData);const score=null!=progressData&&progressData.score?progressData.score:0,completedLevels=null!=progressData&&progressData.completedLevels?progressData.completedLevels:0,puzzleSolved=null!=progressData&&progressData.puzzleSolved?1:0,response=await(0,_ajax.call)([{methodname:"mod_webgl_signal_game_progress",args:{webglid:webglid,score:score,completedlevels:completedLevels,puzzlesolved:puzzleSolved}}])[0];response?(handleCompletionData(response.completiondata),window.console.log(response)):window.console.error("Error setting webgl "+webglid+" progress data")},window.mod_webgl_plugin.initted=!0,(0,_jquery.default)(document).ready((()=>{checkWebglIframeLoaded()}))}}));

//# sourceMappingURL=unitygame.min.js.map