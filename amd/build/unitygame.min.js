define("mod_webgl/unitygame",["exports","core/ajax","jquery"],(function(_exports,_ajax,_jquery){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj},window.mod_webgl_plugin={initted:!1,trackGameViewed:()=>{},trackGameProgress:()=>{}};_exports.init=()=>{const setGameLoaded=async()=>{const webglid=(0,_jquery.default)(".webgl-iframe-content-loader").data("webgl"),response=await(0,_ajax.call)([{methodname:"mod_webgl_signal_game_loaded",args:{webglid:webglid}}])[0];response||window.console.error("Error setting webgl "+webglid+" as viewed"),window.console.log(response)},checkWebglIframeLoaded=()=>{const unityFrame=(0,_jquery.default)(".webgl-iframe-content-loader iframe");if(unityFrame.length<1)return;const unityLoadingBar=unityFrame[0].contentDocument.querySelector("#unity-loading-bar");if(!unityLoadingBar)return;"none"==unityLoadingBar.style.display?setGameLoaded():setTimeout(checkWebglIframeLoaded,250)};window.mod_webgl_plugin.trackGameViewed=setGameLoaded,window.mod_webgl_plugin.trackGameProgress=async progressData=>{const webglid=(0,_jquery.default)(".webgl-iframe-content-loader").data("webgl");window.console.log("Setting progress data object"),window.console.log(progressData);const score=null!=progressData&&progressData.score?progressData.score:0,completedLevels=null!=progressData&&progressData.completedLevels?progressData.completedLevels:0,puzzleSolved=null!=progressData&&progressData.puzzleSolved?1:0,response=await(0,_ajax.call)([{methodname:"mod_webgl_signal_game_progress",args:{webglid:webglid,score:score,completedlevels:completedLevels,puzzlesolved:puzzleSolved}}])[0];window.console.log("completed game? "+response),response&&(0,_jquery.default)("#mod_webgl_course_url").submit()},window.mod_webgl_plugin.initted=!0,(0,_jquery.default)(document).ready(checkWebglIframeLoaded)}}));

//# sourceMappingURL=unitygame.min.js.map