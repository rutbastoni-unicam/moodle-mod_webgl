{"version":3,"file":"unitygame.min.js","sources":["../src/unitygame.js"],"sourcesContent":["//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/messages/>.\nimport {call as fetchMany} from 'core/ajax';\nimport $ from 'jquery';\n\n/**\n * Handle progress game from Unity interface to Moodle\n *\n * @module     mod_webgl\n */\nwindow.mod_webgl_plugin = {\n    initted: false,\n    trackGameViewed: () => {},\n    trackGameProgress: (progressData) => {}\n};\n\n/**\n * @typedef {Object} ProgressData\n * @property {number} score - achieved game score\n * @property {number} completedLevels - number of completed game levels\n * @property {boolean} puzzleSolved - if the puzzle of this game has been solved\n */\n\nexport const init = () => {\n    /**\n     * Call to internal API to set this game as viewed\n     */\n    const setGameLoaded = async () => {\n        const webglid = $('.webgl-iframe-content-loader').data('webgl');\n\n        const response = await fetchMany([{\n            methodname: 'mod_webgl_signal_game_loaded',\n            args: {'webglid': webglid}\n        }])[0];\n\n        if (!response) {\n            window.console.error('Error setting webgl ' + webglid + ' as viewed');\n        }\n        window.console.log(response);\n\n    };\n\n    /**\n     *\n      * @param {ProgressData} progressData\n     * @returns {Promise<void>}\n     */\n    const setGameProgress = async (progressData) => {\n        const webglid = $('.webgl-iframe-content-loader').data('webgl');\n        window.console.log('Setting progress data object');\n        window.console.log(progressData);\n\n        //public static function signal_game_progress($webglid, $score, $completedlevels, $puzzlesolved) {\n        const score = progressData?.score ? progressData.score : 0;\n        const completedLevels = progressData?.completedLevels ? progressData.completedLevels : 0;\n        const puzzleSolved = progressData?.puzzleSolved ? 1 : 0;\n\n        const response = await fetchMany([{\n            methodname: 'mod_webgl_signal_game_progress',\n            args: {'webglid': webglid, 'score': score, 'completedlevels': completedLevels, 'puzzlesolved': puzzleSolved}\n        }])[0];\n\n        window.console.log('completed game? ' + response);\n        if (response) {\n            // Completed activity so the user can return to the course\n            $('#mod_webgl_course_url').submit();\n        }\n\n    };\n\n    window.mod_webgl_plugin.trackGameViewed = setGameLoaded;\n    window.mod_webgl_plugin.trackGameProgress = setGameProgress;\n\n    window.console.error('>>>unityGame setup ready');\n    window.mod_webgl_plugin.initted = true;\n};"],"names":["window","mod_webgl_plugin","initted","trackGameViewed","trackGameProgress","progressData","async","webglid","data","response","methodname","args","console","error","log","score","completedLevels","puzzleSolved","submit"],"mappings":"6OAgBAA,OAAOC,iBAAmB,CACtBC,SAAS,EACTC,gBAAiB,OACjBC,kBAAoBC,gCAUJ,KA+ChBL,OAAOC,iBAAiBE,gBA3CFG,gBACZC,SAAU,mBAAE,gCAAgCC,KAAK,SAEjDC,eAAiB,cAAU,CAAC,CAC9BC,WAAY,+BACZC,KAAM,SAAYJ,YAClB,GAECE,UACDT,OAAOY,QAAQC,MAAM,uBAAyBN,QAAU,cAE5DP,OAAOY,QAAQE,IAAIL,WAiCvBT,OAAOC,iBAAiBG,kBAxBAE,MAAAA,qBACdC,SAAU,mBAAE,gCAAgCC,KAAK,SACvDR,OAAOY,QAAQE,IAAI,gCACnBd,OAAOY,QAAQE,IAAIT,oBAGbU,MAAQV,MAAAA,cAAAA,aAAcU,MAAQV,aAAaU,MAAQ,EACnDC,gBAAkBX,MAAAA,cAAAA,aAAcW,gBAAkBX,aAAaW,gBAAkB,EACjFC,aAAeZ,MAAAA,cAAAA,aAAcY,aAAe,EAAI,EAEhDR,eAAiB,cAAU,CAAC,CAC9BC,WAAY,iCACZC,KAAM,SAAYJ,cAAkBQ,sBAA0BC,6BAAiCC,iBAC/F,GAEJjB,OAAOY,QAAQE,IAAI,mBAAqBL,UACpCA,8BAEE,yBAAyBS,UAQnClB,OAAOY,QAAQC,MAAM,4BACrBb,OAAOC,iBAAiBC,SAAU"}